extends LeafAction

var working_map: GDImap = null

func tick(agent: Ship, blackboard: Blackboard) -> int:
	if agent.combat_flag == false and Engine.get_physics_frames() % 67 != 0:
		return FAILURE
	
	if agent.fallback_flag == true and agent.vent_flux_flag == true:
		return FAILURE
	
	var nearby_allies: Array = []
	var nearby_enemies: Array = []
	for unit in agent.neighbor_units:
		if unit == null:
			continue
		if unit.is_friendly != agent.is_friendly:
			nearby_enemies.append(unit)
		elif unit.is_friendly == agent.is_friendly:
			nearby_allies.append(unit)
	
	if nearby_enemies.size() > nearby_allies.size():
		agent.fallback_flag = true
	
	return FAILURE
